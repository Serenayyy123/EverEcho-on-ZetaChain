# MetaMask Disconnect å®Œæ•´æŒ‡å—

## é‡è¦è¯´æ˜

### MetaMask çš„é™åˆ¶
**MetaMask ä¸æä¾›ç¨‹åºåŒ–æ–­å¼€è¿æ¥çš„ API**ã€‚è¿™æ„å‘³ç€ï¼š
- âŒ å‰ç«¯ä»£ç æ— æ³•ç›´æ¥æ–­å¼€ MetaMask è¿æ¥
- âœ… å‰ç«¯åªèƒ½æ¸…ç©ºè‡ªå·±çš„åº”ç”¨çŠ¶æ€
- âœ… ç”¨æˆ·å¿…é¡»åœ¨ MetaMask æ‰©å±•ä¸­æ‰‹åŠ¨æ–­å¼€

è¿™æ˜¯ MetaMask çš„å®‰å…¨è®¾è®¡ï¼Œé˜²æ­¢æ¶æ„ç½‘ç«™å¼ºåˆ¶æ–­å¼€ç”¨æˆ·é’±åŒ…ã€‚

---

## å½“å‰å®ç°

### Disconnect æŒ‰é’®çš„è¡Œä¸º

å½“ç”¨æˆ·ç‚¹å‡» "Disconnect" æŒ‰é’®æ—¶ï¼š

1. **æ¸…ç©ºå‰ç«¯çŠ¶æ€**ï¼š
   - `address` â†’ `null`
   - `provider` â†’ `null`
   - `signer` â†’ `null`
   - `isRegistered` â†’ `false`
   - `balance` â†’ `'0'`
   - `tasks` â†’ `[]`

2. **UI æ›´æ–°**ï¼š
   - æ˜¾ç¤º "Please connect your wallet" æç¤º
   - æ˜¾ç¤º "Connect Wallet" æŒ‰é’®
   - éšè—ç”¨æˆ·æ•°æ®

3. **MetaMask çŠ¶æ€**ï¼š
   - âš ï¸ MetaMask ä»ç„¶ä¿æŒè¿æ¥çŠ¶æ€
   - âš ï¸ ç½‘ç«™ä»åœ¨ MetaMask çš„"å·²è¿æ¥ç½‘ç«™"åˆ—è¡¨ä¸­

### Connect Wallet æŒ‰é’®çš„è¡Œä¸º

å½“ç”¨æˆ·ç‚¹å‡» "Connect Wallet" æŒ‰é’®æ—¶ï¼š

1. **è§¦å‘ MetaMask æˆæƒ**ï¼š
   - è°ƒç”¨ `eth_requestAccounts`
   - å¦‚æœ MetaMask å·²è¿æ¥ï¼Œç›´æ¥è¿”å›è´¦æˆ·
   - å¦‚æœ MetaMask æœªè¿æ¥ï¼Œå¼¹å‡ºæˆæƒçª—å£

2. **é‡æ–°åŠ è½½æ•°æ®**ï¼š
   - è·å–é’±åŒ…åœ°å€
   - æ£€æŸ¥æ³¨å†ŒçŠ¶æ€
   - åŠ è½½ä½™é¢
   - åŠ è½½ä»»åŠ¡åˆ—è¡¨

---

## å®Œæ•´æ–­å¼€è¿æ¥çš„æ­¥éª¤

å¦‚æœç”¨æˆ·æƒ³è¦**å®Œå…¨æ–­å¼€** MetaMask è¿æ¥ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š

### æ­¥éª¤ 1: åœ¨åº”ç”¨ä¸­ç‚¹å‡» Disconnect
1. ç‚¹å‡»å³ä¸Šè§’çš„ "Disconnect" æŒ‰é’®
2. å‰ç«¯çŠ¶æ€è¢«æ¸…ç©º
3. é¡µé¢æ˜¾ç¤º "Connect Wallet" æŒ‰é’®

### æ­¥éª¤ 2: åœ¨ MetaMask ä¸­æ–­å¼€è¿æ¥
1. ç‚¹å‡» MetaMask æ‰©å±•å›¾æ ‡
2. ç‚¹å‡»å³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹ (â‹®)
3. é€‰æ‹© "å·²è¿æ¥çš„ç½‘ç«™" æˆ– "Connected sites"
4. æ‰¾åˆ° "localhost:5173" æˆ–ä½ çš„ç½‘ç«™
5. ç‚¹å‡» "æ–­å¼€è¿æ¥" æˆ– "Disconnect"

### æ­¥éª¤ 3: é‡æ–°è¿æ¥ï¼ˆå¦‚æœéœ€è¦ï¼‰
1. åœ¨åº”ç”¨ä¸­ç‚¹å‡» "Connect Wallet"
2. MetaMask ä¼šå¼¹å‡ºæˆæƒçª—å£
3. ç‚¹å‡» "è¿æ¥" æˆ– "Connect"
4. åº”ç”¨é‡æ–°åŠ è½½æ•°æ®

---

## ç”¨æˆ·ä½“éªŒæ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: æ·»åŠ æç¤ºä¿¡æ¯ï¼ˆå·²å®ç°ï¼‰

åœ¨ disconnect å‡½æ•°ä¸­æ·»åŠ æ§åˆ¶å°æç¤ºï¼š
```typescript
console.info('Note: To fully disconnect, please disconnect in MetaMask extension.');
```

### æ–¹æ¡ˆ B: æ·»åŠ  UI æç¤ºï¼ˆæ¨èï¼‰

åœ¨ PageLayout ä¸­æ·»åŠ ä¸€ä¸ªæç¤ºï¼Œå‘Šè¯‰ç”¨æˆ·å¦‚ä½•å®Œå…¨æ–­å¼€ï¼š

```typescript
// åœ¨ Disconnect æŒ‰é’®æ—è¾¹æ·»åŠ æç¤ºå›¾æ ‡
<Button variant="danger" size="sm" onClick={disconnect}>
  Disconnect
</Button>
<Tooltip content="This clears app data. To fully disconnect, use MetaMask extension.">
  â„¹ï¸
</Tooltip>
```

### æ–¹æ¡ˆ C: æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†

åœ¨ç‚¹å‡» Disconnect æ—¶æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼š
```typescript
const handleDisconnect = () => {
  const confirmed = window.confirm(
    'This will clear your session data.\n\n' +
    'To fully disconnect from MetaMask, please:\n' +
    '1. Open MetaMask extension\n' +
    '2. Go to Connected Sites\n' +
    '3. Disconnect this site\n\n' +
    'Continue?'
  );
  if (confirmed) {
    disconnect();
  }
};
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç‚¹å‡» Disconnect åï¼ŒMetaMask ä»ç„¶æ˜¾ç¤ºå·²è¿æ¥ï¼Ÿ
**A**: è¿™æ˜¯æ­£å¸¸çš„ã€‚MetaMask ä¸å…è®¸ç½‘ç«™ç¨‹åºåŒ–æ–­å¼€è¿æ¥ã€‚å‰ç«¯åªèƒ½æ¸…ç©ºè‡ªå·±çš„çŠ¶æ€ã€‚

### Q2: å¦‚ä½•å®Œå…¨æ–­å¼€ MetaMask è¿æ¥ï¼Ÿ
**A**: å¿…é¡»åœ¨ MetaMask æ‰©å±•ä¸­æ‰‹åŠ¨æ–­å¼€ã€‚æ­¥éª¤ï¼š
1. æ‰“å¼€ MetaMask
2. ä¸‰ä¸ªç‚¹ (â‹®) â†’ å·²è¿æ¥çš„ç½‘ç«™
3. æ‰¾åˆ°ç½‘ç«™ â†’ æ–­å¼€è¿æ¥

### Q3: ç‚¹å‡» Connect Wallet åä¼šé‡æ–°æˆæƒå—ï¼Ÿ
**A**: 
- å¦‚æœ MetaMask ä»ç„¶è¿æ¥ï¼šç›´æ¥è¿”å›è´¦æˆ·ï¼Œä¸å¼¹çª—
- å¦‚æœ MetaMask å·²æ–­å¼€ï¼šå¼¹å‡ºæˆæƒçª—å£

### Q4: è¿™æ ·çš„å®ç°å®‰å…¨å—ï¼Ÿ
**A**: æ˜¯çš„ã€‚è¿™æ˜¯æ ‡å‡†çš„ Web3 åº”ç”¨å®ç°æ–¹å¼ï¼š
- å‰ç«¯æ¸…ç©ºçŠ¶æ€ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
- MetaMask ä¿æŒè¿æ¥ï¼Œæ–¹ä¾¿ç”¨æˆ·å¿«é€Ÿé‡è¿
- ç”¨æˆ·å¯ä»¥åœ¨ MetaMask ä¸­å®Œå…¨æ–­å¼€

### Q5: å…¶ä»– DApp æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ
**A**: å¤§å¤šæ•° DAppï¼ˆå¦‚ Uniswapã€OpenSeaï¼‰éƒ½æ˜¯è¿™æ ·å®ç°çš„ï¼š
- "Disconnect" æŒ‰é’®åªæ¸…ç©ºå‰ç«¯çŠ¶æ€
- ä¸å¼ºåˆ¶æ–­å¼€ MetaMask è¿æ¥
- ç”¨æˆ·éœ€è¦åœ¨ MetaMask ä¸­æ‰‹åŠ¨æ–­å¼€

---

## æœ€ä½³å®è·µ

### å¯¹äºå¼€å‘è€…

1. **æ¸…ç©ºå‰ç«¯çŠ¶æ€**ï¼š
   - ç¡®ä¿æ‰€æœ‰ç”¨æˆ·æ•°æ®è¢«æ¸…ç©º
   - ç¡®ä¿ UI æ­£ç¡®æ›´æ–°

2. **æä¾›æ¸…æ™°çš„æç¤º**ï¼š
   - å‘Šè¯‰ç”¨æˆ·å¦‚ä½•å®Œå…¨æ–­å¼€
   - æä¾› MetaMask æ–­å¼€è¿æ¥çš„é“¾æ¥æˆ–è¯´æ˜

3. **å¤„ç†é‡è¿**ï¼š
   - ç¡®ä¿ Connect æŒ‰é’®æ­£ç¡®è§¦å‘æˆæƒ
   - å¤„ç†ç”¨æˆ·æ‹’ç»æˆæƒçš„æƒ…å†µ

### å¯¹äºç”¨æˆ·

1. **å¿«é€Ÿåˆ‡æ¢è´¦æˆ·**ï¼š
   - ç‚¹å‡» Disconnect æ¸…ç©ºæ•°æ®
   - åœ¨ MetaMask ä¸­åˆ‡æ¢è´¦æˆ·
   - ç‚¹å‡» Connect Wallet é‡æ–°è¿æ¥

2. **å®Œå…¨æ–­å¼€**ï¼š
   - ç‚¹å‡» Disconnect
   - åœ¨ MetaMask ä¸­æ–­å¼€ç½‘ç«™è¿æ¥
   - å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µ

3. **å®‰å…¨å»ºè®®**ï¼š
   - ä½¿ç”¨å®Œæ¯•åï¼Œåœ¨ MetaMask ä¸­æ–­å¼€è¿æ¥
   - å®šæœŸæ£€æŸ¥ MetaMask çš„å·²è¿æ¥ç½‘ç«™åˆ—è¡¨
   - åªè¿æ¥ä¿¡ä»»çš„ç½‘ç«™

---

## æŠ€æœ¯å®ç°

### å½“å‰çš„ disconnect å‡½æ•°

```typescript
const disconnect = () => {
  console.log('Disconnecting wallet...');
  
  // æ¸…ç©ºå‰ç«¯çŠ¶æ€
  setAddress(null);
  setChainId(null);
  setProvider(null);
  setSigner(null);
  setIsRegistered(false);
  setBalance('0');
  setError(null);
  
  console.log('Wallet disconnected, state cleared');
  console.info('Note: To fully disconnect, please disconnect in MetaMask extension.');
};
```

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ wallet_revokePermissionsï¼Ÿ

MetaMask æ›¾ç»æœ‰ `wallet_revokePermissions` APIï¼Œä½†ï¼š
- å·²è¢«åºŸå¼ƒ
- ä¸æ˜¯æ‰€æœ‰é’±åŒ…éƒ½æ”¯æŒ
- å¯èƒ½å¯¼è‡´å…¼å®¹æ€§é—®é¢˜

æ ‡å‡†åšæ³•æ˜¯è®©ç”¨æˆ·åœ¨é’±åŒ…ä¸­æ‰‹åŠ¨æ–­å¼€ã€‚

---

## æ›¿ä»£æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨ WalletConnect

å¦‚æœéœ€è¦ç¨‹åºåŒ–æ–­å¼€ï¼Œå¯ä»¥ä½¿ç”¨ WalletConnectï¼š
- æ”¯æŒç¨‹åºåŒ–æ–­å¼€
- æ”¯æŒå¤šç§é’±åŒ…
- ä½†éœ€è¦é¢å¤–çš„é›†æˆå·¥ä½œ

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Web3Modal

Web3Modal æä¾›äº†æ›´å¥½çš„é’±åŒ…ç®¡ç†ï¼š
- ç»Ÿä¸€çš„è¿æ¥/æ–­å¼€æ¥å£
- æ”¯æŒå¤šç§é’±åŒ…
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

ä½†è¿™éœ€è¦é‡æ„ç°æœ‰ä»£ç ã€‚

---

## æ€»ç»“

### å½“å‰å®ç°æ˜¯æ­£ç¡®çš„

âœ… å‰ç«¯æ¸…ç©ºçŠ¶æ€  
âœ… UI æ­£ç¡®æ›´æ–°  
âœ… å¯ä»¥é‡æ–°è¿æ¥  
âœ… ç¬¦åˆ Web3 æ ‡å‡†å®è·µ

### ç”¨æˆ·éœ€è¦çŸ¥é“

âš ï¸ "Disconnect" åªæ¸…ç©ºåº”ç”¨æ•°æ®  
âš ï¸ å®Œå…¨æ–­å¼€éœ€è¦åœ¨ MetaMask ä¸­æ“ä½œ  
âš ï¸ è¿™æ˜¯æ‰€æœ‰ DApp çš„æ ‡å‡†è¡Œä¸º

### æ”¹è¿›å»ºè®®

ğŸ’¡ æ·»åŠ  UI æç¤ºï¼Œè¯´æ˜å¦‚ä½•å®Œå…¨æ–­å¼€  
ğŸ’¡ æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†ï¼Œæé†’ç”¨æˆ·  
ğŸ’¡ åœ¨æ–‡æ¡£ä¸­è¯´æ˜æ–­å¼€æµç¨‹

---

**æœ€åæ›´æ–°**: 2024-11-24  
**ç›¸å…³æ–‡æ¡£**: 
- [MetaMask å®˜æ–¹æ–‡æ¡£](https://docs.metamask.io/wallet/how-to/connect/)
- [EIP-1193: Ethereum Provider JavaScript API](https://eips.ethereum.org/EIPS/eip-1193)
